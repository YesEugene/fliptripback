# üîí –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Row Level Security (RLS) –¥–ª—è FlipTrip

## –ü—Ä–æ–±–ª–µ–º–∞

Supabase Security Advisor –æ–±–Ω–∞—Ä—É–∂–∏–ª **30 –æ—à–∏–±–æ–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**: –Ω–∞ –≤—Å–µ—Ö –ø—É–±–ª–∏—á–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö –Ω–µ –≤–∫–ª—é—á–µ–Ω Row Level Security (RLS). –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —á–µ—Ä–µ–∑ PostgREST API.

## –†–µ—à–µ–Ω–∏–µ

–°–∫—Ä–∏–ø—Ç `enable-rls-security.sql` –≤–∫–ª—é—á–∞–µ—Ç RLS –Ω–∞ –≤—Å–µ—Ö –ø—É–±–ª–∏—á–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö –∏ —Å–æ–∑–¥–∞–µ—Ç –±–∞–∑–æ–≤—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

## üìã –¢–∞–±–ª–∏—Ü—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∑–∞—â–∏—â–µ–Ω—ã

- ‚úÖ `public.users` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- ‚úÖ `public.guides` - –≥–∏–¥—ã/–∫—Ä–µ–∞—Ç–æ—Ä—ã
- ‚úÖ `public.countries` - —Å—Ç—Ä–∞–Ω—ã
- ‚úÖ `public.cities` - –≥–æ—Ä–æ–¥–∞
- ‚úÖ `public.locations` - –ª–æ–∫–∞—Ü–∏–∏
- ‚úÖ `public.location_photos` - —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –ª–æ–∫–∞—Ü–∏–π
- ‚úÖ `public.location_tags` - —Ç–µ–≥–∏ –ª–æ–∫–∞—Ü–∏–π
- ‚úÖ `public.tags` - —Ç–µ–≥–∏
- ‚úÖ `public.tours` - —Ç—É—Ä—ã
- ‚úÖ `public.tour_days` - –¥–Ω–∏ —Ç—É—Ä–æ–≤
- ‚úÖ `public.tour_blocks` - –±–ª–æ–∫–∏ –¥–Ω–µ–π
- ‚úÖ `public.tour_items` - —ç–ª–µ–º–µ–Ω—Ç—ã –±–ª–æ–∫–æ–≤

## üöÄ –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å

### –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [supabase.com/dashboard](https://supabase.com/dashboard)
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç **FlipTrip**
3. –û—Ç–∫—Ä–æ–π—Ç–µ **SQL Editor** –≤ –ª–µ–≤–æ–º –º–µ–Ω—é

### –®–∞–≥ 2: –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `database/enable-rls-security.sql`
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–∫—Ä–∏–ø—Ç–∞
3. –í—Å—Ç–∞–≤—å—Ç–µ –≤ SQL Editor –≤ Supabase
4. –ù–∞–∂–º–∏—Ç–µ **Run** (–∏–ª–∏ `Cmd/Ctrl + Enter`)

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç

1. –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞ –≤—ã —É–≤–∏–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:
   ```
   ‚úÖ RLS –í–ö–õ–Æ–ß–ï–ù –ù–ê X –¢–ê–ë–õ–ò–¶–ê–•
   ‚úÖ –°–û–ó–î–ê–ù–û X –ü–û–õ–ò–¢–ò–ö –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò
   ```

2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Security Advisor**:
   - –õ–µ–≤–æ–µ –º–µ–Ω—é ‚Üí **Advisors** ‚Üí **Security Advisor**
   - –û—à–∏–±–∫–∏ –¥–æ–ª–∂–Ω—ã –∏—Å—á–µ–∑–Ω—É—Ç—å (–∏–ª–∏ —É–º–µ–Ω—å—à–∏—Ç—å—Å—è)

## üîê –ß—Ç–æ –¥–µ–ª–∞—é—Ç –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –ü—É–±–ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—á—Ç–µ–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö)
- **countries, cities, tags** - –≤—Å–µ –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å
- **locations, location_photos, location_tags** - –≤—Å–µ –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å
- **guides** - –≤—Å–µ –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å –ø—É–±–ª–∏—á–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏
- **tours** - –≤—Å–µ –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ —Ç—É—Ä—ã (`status = 'approved'` –∏–ª–∏ `is_published = true`)

### –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü)
- **users** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å/–æ–±–Ω–æ–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å
- **guides** - –≥–∏–¥—ã –º–æ–≥—É—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å
- **tours** - —Å–æ–∑–¥–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏–º–∏ —Ç—É—Ä–∞–º–∏
- **locations** - —Å–æ–∑–¥–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏–º–∏ –ª–æ–∫–∞—Ü–∏—è–º–∏

### –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- **tour_days, tour_blocks, tour_items** - –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è —á—Ç–µ–Ω–∏—è, –µ—Å–ª–∏ —Ç—É—Ä –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω
- –°–æ–∑–¥–∞—Ç–µ–ª–∏ —Ç—É—Ä–æ–≤ –º–æ–≥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –≤—Å–µ–º–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ —Å–≤–æ–∏—Ö —Ç—É—Ä–æ–≤

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—É–±–ª–∏—á–Ω—ã–µ —Ç—É—Ä—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Ç—É—Ä—ã
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–æ–∑–¥–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–∏ —Ç—É—Ä—ã

2. **–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Supabase Dashboard ‚Üí Logs
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã (–¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç—É—Ä—ã –∏–º–µ—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å (`status = 'approved'` –∏–ª–∏ `is_published = true`)

3. **–î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:**
   - –ï—Å–ª–∏ –Ω—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –∫–æ –≤—Å–µ–º –¥–∞–Ω–Ω—ã–º, –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –ø–æ–ª–∏—Ç–∏–∫—É:
   ```sql
   -- –ü—Ä–∏–º–µ—Ä: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –≤—Å–µ
   CREATE POLICY "Admins can do everything"
   ON public.tours
   FOR ALL
   USING (
     EXISTS (
       SELECT 1 FROM public.admins
       WHERE admins.user_id = auth.uid()
     )
   );
   ```

## üìä –ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞:
- ‚úÖ Security Advisor –ø–æ–∫–∞–∂–µ—Ç 0 –æ—à–∏–±–æ–∫ (–∏–ª–∏ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –º–µ–Ω—å—à–µ)
- ‚úÖ –í—Å–µ –ø—É–±–ª–∏—á–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –±—É–¥—É—Ç –∑–∞—â–∏—â–µ–Ω—ã RLS
- ‚úÖ –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å–æ–≥–ª–∞—Å–Ω–æ –ø–æ–ª–∏—Ç–∏–∫–∞–º

## üîÑ –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å RLS –Ω–∞ –∫–∞–∫–æ–π-—Ç–æ —Ç–∞–±–ª–∏—Ü–µ (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):

```sql
ALTER TABLE public.tours DISABLE ROW LEVEL SECURITY;
```

–ù–æ —ç—Ç–æ –≤–µ—Ä–Ω–µ—Ç –æ—à–∏–±–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤ Security Advisor.

